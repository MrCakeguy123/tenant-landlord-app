<!doctype html>
<html lang="{{ current_lang or 'en' }}">
  <head>
    <meta charset="utf-8">
    <title>Tenant / Landlord</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- App icon / favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='app-icon.png') }}">

    <!-- Prevent flash of wrong theme -->
    <script>
      (function() {
        const theme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>
  </head>
  <body>
    <header class="topbar">
      <div class="topbar-inner">
        <div class="topbar-left">
          <a href="{{ url_for('dashboard') if session.get('user_id') else url_for('index') }}"
             class="topbar-brand">
            <img src="{{ url_for('static', filename='app-icon.png') }}" alt="" class="brand-icon">
            <span>Tenant / Landlord</span>
          </a>
        </div>
        <div class="topbar-right">
          {% if session.get('user_id') %}
            <a class="button small" href="{{ url_for('dashboard') }}">{{ t('nav_dashboard') }}</a>
            <a class="button small" href="{{ url_for('calendar_view') }}">üìÜ</a>
            <a class="button small" href="{{ url_for('settings') }}">‚öôÔ∏è</a>
            <a class="button small" href="{{ url_for('logout') }}">{{ t('nav_logout') }}</a>
          {% else %}
            <a class="button small" href="{{ url_for('login') }}">{{ t('nav_login') }}</a>
          {% endif %}

          <!-- Dark mode toggle -->
          <button class="theme-toggle" onclick="toggleTheme()" title="Toggle dark mode" aria-label="Toggle dark mode">
            <span id="theme-icon">üåô</span>
          </button>

          <!-- Language selector -->
          <span class="lang-toggle">
            {% for lang in supported_langs %}
              {% if lang == current_lang %}
                <span class="lang-current">{{ lang|upper }}</span>
              {% else %}
                <a href="{{ url_for('set_language', lang=lang) }}">{{ lang|upper }}</a>
              {% endif %}
              {% if not loop.last %} ¬∑ {% endif %}
            {% endfor %}
          </span>
        </div>
      </div>
    </header>

    <main class="container">
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="flash-container">
            {% for category, message in messages %}
              <div class="flash flash-{{ category }}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      {% block content %}{% endblock %}
    </main>

    <!-- Dark mode toggle script -->
    <script>
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute('data-theme') || 'light';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
      }

      function updateThemeIcon(theme) {
        const icon = document.getElementById('theme-icon');
        if (icon) {
          icon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }
      }

      // Set correct icon on page load
      document.addEventListener('DOMContentLoaded', function() {
        const theme = localStorage.getItem('theme') || 'light';
        updateThemeIcon(theme);
      });
    </script>
  </body>
</html>
